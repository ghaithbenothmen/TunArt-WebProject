{% extends 'artiste-dash.html.twig' %}

{% block title %}Liste catégories
{% endblock %}

{% block body %}

	<!-- ============================================================== -->
	<!-- Bread crumb and right sidebar toggle -->
	<!-- ============================================================== -->
		<div class="page-breadcrumb"> <div class="row">
			<div class="col-7 align-self-center">
				<h4 class="page-title text-truncate text-dark font-weight-medium mb-1">Liste des catégories</h4>
				<div class="d-flex align-items-center">
					<nav aria-label="breadcrumb">
						<ol class="breadcrumb m-0 p-0">
							<li class="breadcrumb-item">
								<a href="index.html" class="text-muted">Artiste</a>
							</li>
							<li class="breadcrumb-item text-muted active" aria-current="page">Liste catégories</li>
						</ol>
					</nav>
				</div>
			</div>

			<div class="col-5 align-self-center">
				<div class="customize-input float-right">
					<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
						Ajouter Categorie
					</button>
				</div>
			</div>
		</div>
	</div>
	<!-- ============================================================== -->
	<!-- End Bread crumb and right sidebar toggle -->
	<!-- ============================================================== -->
	<!-- ============================================================== -->
	<!-- Container fluid  -->
	<!-- ============================================================== -->
		<div
		class="container-fluid"> <!-- ============================================================== -->

		<div class="row">
			<div class="col-12">
				<div class="card">
					<div class="card-body">

						<div class="table-responsive">
							<table id="zero_config" class="table table-striped table-bordered no-wrap">
								<thead>
									<tr>
										<th>Id</th>
										<th>Nom</th>
										<th>Actions</th>
									</tr>
								</thead>
								<tbody>
									{% for cat in categories %}
										<tr>
											<th scope="col">{{ cat.id }}</th>
											<td>{{ cat.nom|upper }}</td>
											<td>

												<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#updateModal{{ cat.id }}">
													<i class="fas fa-edit"></i>
													Edit
												</button>


												<button type="button" data-bs-toggle="modal" class="btn btn-danger btn-sm" data-bs-target="#deleteModal{{ cat.id }}">
													<i class="fas fa-trash-alt"></i>
													Delete
												</button>

											</td>
										</tr>
									{% endfor %}
								</tbody>

							</table>
							<ul class="pagination float-right">
								<li class="page-item disabled">
									<a class="page-link" href="#" tabindex="-1">Previous</a>
								</li>
								<li class="page-item active">
									<a class="page-link" href="#">1</a>
								</li>
								<li class="page-item">
									<a class="page-link" href="#">2
										<span class="sr-only">(current)</span>
									</a>
								</li>
								<li class="page-item">
									<a class="page-link" href="#">3</a>
								</li>
								<li class="page-item">
									<a class="page-link" href="#">Next</a>
								</li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Update Modal for each category -->
 <!-- Update Modal for each category -->
 <!-- Update Modal for each category -->
{% for category in categories %}
    <div class="modal fade" id="updateModal{{ category.id }}" tabindex="-1" aria-labelledby="updateModalLabel{{ category.id }}" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="updateModalLabel{{ category.id }}">Modifier Catégorie</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Update Form for the category -->
                    <form method="post" action="{{ path('app_update_cat', {'id': category.id}) }}">
                        <div class="form-group">
                            <label for="nom{{ category.id }}">Nom:</label>
                            <input type="text" id="nom{{ category.id }}" name="nom" class="form-control" value="{{ category.nom }}" required>
                        </div>
                        <!-- Add more fields as needed -->
                        <button type="submit" class="btn btn-primary"  onclick="updateCategory({{ category.id }})">Modifier</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
{% endfor %}

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="exampleModalLabel">Ajouter Catégorie</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div
				class="modal-body">
				<!-- Form for adding the entity -->

				{{ form_start(f) }}
				<div class="mb-3">

					{{ form_label(f.nom, "Nom catégorie:", {'label_attr': {'class': 'form-label'}}) }}
					{{ form_widget(f.nom, {'attr': {'class': 'form-control','placeholder': 'Entré nom de la catégorie'}}) }}
				</div>
				<!-- Add more fields as needed -->


			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
				{{ form_widget(f.Ajouter, {'attr': {'class': 'btn btn-primary'}}) }}
			</div>
			{{ form_end(f) }}
		</div>
	</div>
</div>
<script>
	$(document).ready(function () {
$('#exampleModal form').submit(function (e) {
e.preventDefault();

$.ajax({
type: 'POST',
url: '{{ path('app_add_cat') }}',
data: $(this).serialize(),
success: function (response) {

$('#exampleModal').modal('hide');
location.reload();
},
error: function (error) { // Handle error
}
});

});
});

function updateCategory(categoryId) {
    var form = document.getElementById('updateForm' + categoryId);
    var formData = new FormData(form);

    fetch(form.action, {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Reload the page to reflect the changes
            location.reload();
        } else {
            // Handle error
            console.error(data.message);
        }
    })
    .catch(error => {
        // Handle fetch error
        console.error(error);
    });
}
</script>{% endblock %}
